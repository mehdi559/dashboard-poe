<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PDF avec CDN</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2rem; }
        .test-button { background: #3b82f6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; margin: 1rem; }
        .test-button:hover { background: #2563eb; }
        .result { margin: 1rem; padding: 1rem; border-radius: 8px; }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .preview { border: 1px solid #e5e7eb; padding: 1rem; margin: 1rem 0; background: white; }
    </style>
    <!-- CDN pour jsPDF et html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <h1>Test PDF avec CDN (jsPDF + html2canvas)</h1>
    <button class="test-button" onclick="testPDFExport()">üìÑ Tester Export PDF</button>
    <div id="result"></div>
    <div id="preview" class="preview"></div>

    <script>
        async function testPDFExport() {
            const resultDiv = document.getElementById('result');
            const previewDiv = document.getElementById('preview');
            
            resultDiv.innerHTML = '<div class="result">üîÑ Test en cours...</div>';
            
            try {
                // V√©rifier que les librairies sont charg√©es
                if (typeof window.jsPDF === 'undefined') {
                    throw new Error('jsPDF non charg√©');
                }
                if (typeof window.html2canvas === 'undefined') {
                    throw new Error('html2canvas non charg√©');
                }
                
                console.log('üìÑ Librairies charg√©es:', { jsPDF: !!window.jsPDF, html2canvas: !!window.html2canvas });
                
                // G√©n√©rer un HTML de test
                const testHTML = `
                    <div style="padding: 2rem; font-family: Arial, sans-serif; background: white; max-width: 800px; margin: 0 auto;">
                        <div style="text-align: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px solid #e5e7eb;">
                            <h1 style="font-size: 2.5rem; font-weight: bold; color: #1f2937; margin-bottom: 0.5rem;">Rapport Mensuel - Janvier 2025</h1>
                            <p style="color: #6b7280; font-size: 1.1rem;">G√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                                <h3 style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 0.5rem;">Total D√©pens√©</h3>
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">1 500,00 ‚Ç¨</div>
                                <div style="font-size: 0.9rem; opacity: 0.75;">75.0% du budget</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                                <h3 style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 0.5rem;">Taux d'√©pargne</h3>
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">25.0%</div>
                                <div style="font-size: 0.9rem; opacity: 0.75;">1 500,00 ‚Ç¨ ce mois</div>
                            </div>
                        </div>
                        
                        <div style="background: #eff6ff; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #3b82f6;">
                            <h3 style="color: #1e40af; font-size: 1.2rem; font-weight: bold; margin-bottom: 1rem;">üí° Recommandations</h3>
                            <ul style="list-style: none;">
                                <li style="margin-bottom: 0.5rem; color: #1e40af;">‚Ä¢ Excellente gestion financi√®re ! Continuez ainsi</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 0.9rem;">
                            G√©n√©r√© par Test User | Future Finance
                        </div>
                    </div>
                `;
                
                // Afficher le preview
                previewDiv.innerHTML = '<h3>Aper√ßu du contenu :</h3>' + testHTML;
                
                console.log('üìÑ HTML g√©n√©r√©:', testHTML.substring(0, 200) + '...');
                
                // Cr√©er l'√©l√©ment temporaire
                const element = document.createElement('div');
                element.innerHTML = testHTML;
                element.style.position = 'absolute';
                element.style.left = '-9999px';
                element.style.top = '-9999px';
                element.style.width = '210mm';
                element.style.height = 'auto';
                element.style.backgroundColor = 'white';
                element.style.padding = '20px';
                document.body.appendChild(element);
                
                console.log('üìÑ √âl√©ment cr√©√©, attente du rendu...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Convertir en canvas avec html2canvas
                const canvas = await window.html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: 794, // A4 width in pixels at 96 DPI
                    height: element.scrollHeight * 2
                });
                
                console.log('üìÑ Canvas cr√©√©');
                
                // Cr√©er le PDF avec jsPDF
                const { jsPDF } = window.jsPDF;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                
                // Calculer les dimensions
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = pdfWidth - 20; // 10mm margin on each side
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                console.log('üìÑ Ajout de l\'image au PDF...');
                pdf.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
                
                // Sauvegarder
                pdf.save('test-pdf-cdn.pdf');
                
                document.body.removeChild(element);
                
                resultDiv.innerHTML = '<div class="result success">‚úÖ Export PDF r√©ussi avec CDN !</div>';
                
            } catch (error) {
                console.error('Erreur test PDF:', error);
                resultDiv.innerHTML = `<div class="result error">‚ùå Erreur: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html> 